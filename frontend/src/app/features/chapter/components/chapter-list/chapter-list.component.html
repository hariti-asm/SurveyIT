<div class="layout-container">

  <div class="tree-panel">
    @if (loading) {
      <p class="loading">Loading chapters...</p>
    } @else if (error) {
      <p class="error">{{ error }}</p>
    } @else {
      @for (chapter of chapters; track chapter.id) {
        <app-chapter-item
          [chapter]="chapter"
          [selectedSubChapterId]="selectedSubChapterId"
          (subChapterSelected)="onSubChapterSelect($event)"/>
      }
    }
  </div>
  @if (selectedSubChapter) {
    <div class="content-panel">
      <div class="questions-section">
        <h3>Questions for {{ selectedSubChapter.title }}</h3>
        @if (loading) {
          <p>Loading questions...</p>
        } @else if (error) {
          <p class="error">{{ error }}</p>
        } @else {
          @for (question of selectedSubChapter.questions; track question.id) {
            <div class="question-container">
              <div
                class="question-header"
                (click)="toggleAnswers(question)"
                [class.expanded]="question.showAnswers">
                <div class="question-text">{{ question.text }}</div>
                <div class="question-type">
                  Type: {{ question.type }}
                </div>
                <span class="expand-icon">{{ question.showAnswers ? '▼' : '▶' }}</span>
              </div>

              @if (question.showAnswers && question.answers?.length) {
                <div class="answers-table">
                  <table>
                    <thead>
                    <tr>
                      <th>Answer</th>
                      <th>Responses</th>
                      <th>Percentage</th>
                    </tr>
                    </thead>
                    <tbody>
                      @for (answer of question.answers; track answer.id) {
                        <tr>
                          <td>{{ answer.text }}</td>
                          <td>{{ answer.selectionCount }}</td>
                          <td>{{ calculatePercentage(answer.selectionCount, question.answerCount) | percent }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </div>
          }
        }
      </div>
    </div>
  }
</div>
